import{_,d as y,o as d,c as r,a as e,w as l,v as g,b as k,e as m,f as b,g as p,h,t as i,F as E,r as q,i as v}from"./index.b1cf285d.js";const C=y({data(){return{queryBusqueda:"",queryBusquedaOG:"",code:"",results:[],resultsOG:[],precioAsc:!1,vendidosAsc:!1,eshopAsc:!1,tablaFormateada:[],filtroCuotas:"yes",filtraCuotas:!1,filtroEstado:"2230284",filtraEstado:!1,filtroEnvios:"free",filtraEnvios:!1}},mounted(){var t=window.localStorage.getItem("token");t==null&&this.checkParam()},methods:{queryFiltros(){var t="";return this.filtraCuotas&&(t="&installments="+this.filtroCuotas),this.filtraEstado&&(t+="&ITEM_CONDITION="+this.filtroEstado),this.filtraEnvios&&this.filtroEnvios!=""&&(t+="&shipping_cost="+this.filtroEnvios),t},buscarQuery(){var t=this.queryFiltros();this.tablaFormateada=[];var s=window.localStorage.getItem("token");this.queryBusquedaOG=this.queryBusqueda;var a=this.queryBusqueda.replaceAll(" ","%20");$.ajax({type:"GET",url:"https://api.mercadolibre.com/sites/MLA/search?q="+a+t,authorization:"Bearer "+s}).then(n=>{var f=n.paging.total,c=Math.ceil(f/50)-1;this.results=n.results,this.resultsOG=this.results;for(var o=1;o<=c;o++)$.ajax({type:"GET",url:"https://api.mercadolibre.com/sites/MLA/search?q="+a+t+"&offset="+o*50,authorization:"Bearer "+s}).then(u=>{this.results.push(...u.results),this.resultsOG=this.results}).catch(u=>{u.response.error=="invalid_grant"&&v.checkParam(),u.response.message=="Invalid token"&&v.refreshToken(),console.log(u)})}).catch(n=>{n.response.error=="invalid_grant"&&v.checkParam(),n.response.message=="Invalid token"&&v.refreshToken(),console.log(n)})},formatTable(){this.results.forEach(t=>{var a,n,f,c;var s={titulo:t.title,linkpubli:t.permalink,linkvendedor:t.seller.permalink,nombreeshop:t.seller.eshop!=null?t.seller.eshop.nick_name:"-",condicion:t.condition,precio:t.price,disponibles:t.available_quantity,vendidos:t.sold_quantity,cuotas:(n=(a=t.installments)==null?void 0:a.quantity)!=null?n:"-",intereses:(c=(f=t.installments)==null?void 0:f.rate)!=null?c:"-",envio:t.shipping.free_shipping};t.installments==null&&console.log(t),this.tablaFormateada.push(s)})},exportXlsx(){this.formatTable();var t=this.queryBusquedaOG.replaceAll(" ","-"),s=XLSX.utils.json_to_sheet(this.tablaFormateada);const a=XLSX.utils.book_new();XLSX.utils.book_append_sheet(a,s,"Publicaciones"),XLSX.utils.sheet_add_aoa(s,[["titulo","link de la publicacion","link del vendedor","nombre del Eshop","condicion","precio","cantidad disponible","cantidad vendidos","cuotas","interes","envio gratis"]],{origin:"A1"}),XLSX.writeFile(a,t+".xlsx",{compression:!0})}}}),B={class:"container"},V=e("h2",null,"Metricas de de busqueda por producto",-1),w={class:"flex-inline"},T=["disabled"],U={class:"flex-inline-left",style:{"margin-top":"15px","margin-bottom":"5px"}},X={class:"flex-inline-left"},S={for:"festado"},F={key:0},L={class:"gap"},A=e("br",null,null,-1),G=e("label",{for:"nuevo"},"Nuevo",-1),I={class:"gap"},M=e("br",null,null,-1),O=e("label",{for:"usado"},"Usado",-1),N={class:"gap"},P=e("label",{for:"reacondicionado"},"Reacondicionado",-1),j={class:"flex-inline-left"},D={for:"fcuotas"},Q={key:0},z={class:"gap"},K=e("br",null,null,-1),R=e("label",{for:"interes"},"Todos",-1),H={class:"gap"},J=e("br",null,null,-1),W=e("label",{for:"nointeres"},"Sin interes",-1),Y={class:"flex-inline-left"},Z={for:"fenvios"},x={key:0},ee={class:"gap"},te=e("br",null,null,-1),oe=e("label",{for:"enviogratis"},"Envio gratis",-1),se={class:"gap"},le=e("br",null,null,-1),ie=e("label",{for:"enviopago"},"Todos",-1),ne={class:"flex-inline-between",style:{"margin-top":"15px","margin-bottom":"5px"}},ae={key:0},de={key:0,class:"table-responsive",style:{"margin-top":"20px"}},re={id:"tabla",class:"table table-bordered"},ue=e("thead",null,[e("tr",null,[e("th",null,"img de portada"),e("th",null,"titulo"),e("th",null,"link de la publicacion"),e("th",null,"nombre del vendedor"),e("th",null,"condicion"),e("th",null,"precio"),e("th",null,"cantidad disponible"),e("th",null,"cantidad vendidos"),e("th",null,"cuotas"),e("th",null,"interes"),e("th",null,"envio gratis")])],-1),pe=["src"],he=["href"],fe=e("p",null,"Las cantidades de items vendidos y disponibles son aproximaciones",-1);function ce(t,s,a,n,f,c){return d(),r("div",B,[V,e("div",w,[l(e("input",{type:"text",class:"form-control",onKeyup:s[0]||(s[0]=k(o=>t.buscarQuery(),["enter"])),"onUpdate:modelValue":s[1]||(s[1]=o=>t.queryBusqueda=o)},null,544),[[g,t.queryBusqueda]]),e("button",{disabled:t.queryBusqueda=="",class:"btn btn-primary",onClick:s[2]||(s[2]=o=>t.buscarQuery())},"Buscar",8,T)]),e("div",U,[e("div",X,[e("label",S,[m("Estado del Item "),l(e("input",{id:"festado",type:"checkbox","onUpdate:modelValue":s[3]||(s[3]=o=>t.filtraEstado=o)},null,512),[[b,t.filtraEstado]])]),t.filtraEstado?(d(),r("div",F,[e("div",L,[l(e("input",{"onUpdate:modelValue":s[4]||(s[4]=o=>t.filtroEstado=o),value:"2230284",type:"radio",id:"nuevo",name:"estado",checked:""},null,512),[[p,t.filtroEstado]]),A,G]),e("div",I,[l(e("input",{"onUpdate:modelValue":s[5]||(s[5]=o=>t.filtroEstado=o),value:"2230581",type:"radio",id:"usado",name:"estado"},null,512),[[p,t.filtroEstado]]),M,O]),e("div",N,[l(e("input",{"onUpdate:modelValue":s[6]||(s[6]=o=>t.filtroEstado=o),value:"2230582",type:"radio",id:"reacondicionado",name:"estado"},null,512),[[p,t.filtroEstado]]),P])])):h("",!0)]),e("div",j,[e("label",D,[m("Cuotas "),l(e("input",{id:"fcuotas",type:"checkbox","onUpdate:modelValue":s[7]||(s[7]=o=>t.filtraCuotas=o)},null,512),[[b,t.filtraCuotas]])]),t.filtraCuotas?(d(),r("div",Q,[e("div",z,[l(e("input",{"onUpdate:modelValue":s[8]||(s[8]=o=>t.filtroCuotas=o),value:"yes",type:"radio",id:"interes",name:"cuotas",checked:""},null,512),[[p,t.filtroCuotas]]),K,R]),e("div",H,[l(e("input",{"onUpdate:modelValue":s[9]||(s[9]=o=>t.filtroCuotas=o),value:"no_interest",type:"radio",id:"nointeres",name:"cuotas"},null,512),[[p,t.filtroCuotas]]),J,W])])):h("",!0)]),e("div",Y,[e("label",Z,[m("Envio "),l(e("input",{id:"fenvios",type:"checkbox","onUpdate:modelValue":s[10]||(s[10]=o=>t.filtraEnvios=o)},null,512),[[b,t.filtraEnvios]])]),t.filtraEnvios?(d(),r("div",x,[e("div",ee,[l(e("input",{"onUpdate:modelValue":s[11]||(s[11]=o=>t.filtroEnvios=o),value:"free",type:"radio",id:"enviogratis",name:"envio",checked:""},null,512),[[p,t.filtroEnvios]]),te,oe]),e("div",se,[l(e("input",{"onUpdate:modelValue":s[12]||(s[12]=o=>t.filtroEnvios=o),value:"",type:"radio",id:"enviopago",name:"envio"},null,512),[[p,t.filtroEnvios]]),le,ie])])):h("",!0)])]),e("div",ne,[t.results.length>0?(d(),r("p",ae,"Cantidad: "+i(t.results.length),1)):h("",!0),t.results.length>0?(d(),r("button",{key:1,onClick:s[13]||(s[13]=o=>t.exportXlsx()),class:"btn btn-outline-success"},"Exportar")):h("",!0)]),t.results.length>0?(d(),r("div",de,[e("table",re,[ue,e("tbody",null,[(d(!0),r(E,null,q(t.results,(o,u)=>(d(),r("tr",{key:u},[e("td",null,[e("img",{style:{"max-width":"100px","max-height":"100px"},src:o.thumbnail,alt:"logo"},null,8,pe)]),e("td",null,i(o.title),1),e("td",null,[e("a",{href:o.permalink},i(o.permalink),9,he)]),e("td",null,i(o.seller.nickname!=null?o.seller.nickname:"-"),1),e("td",null,i(o.condition),1),e("td",null,i(o.price),1),e("td",null,i(o.available_quantity),1),e("td",null,i(o.sold_quantity),1),e("td",null,i(o.installments!=null?o.installments.quantity:"-"),1),e("td",null,"%"+i(o.installments!=null?o.installments.rate:"-"),1),e("td",null,i(o.shipping.free_shipping),1)]))),128))])]),fe])):h("",!0)])}const me=_(C,[["render",ce]]);export{me as default};
