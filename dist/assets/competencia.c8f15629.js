import{_ as k,d as g,o as n,c as o,a as t,w as p,v as m,b as _,h as d,F as b,r as f,i as u,t as l}from"./index.eecef8e0.js";const y=g({data(){return{username:"",competencia:[],code:"",results:[],resultsOG:[],scrollId:"",fecha:"",diasFiltro:1,token:"",notfound:!1,tablaFormateada:[]}},mounted(){var e=window.localStorage.getItem("token");e==null&&this.checkParam(),this.fecha=new Date},methods:{formatFecha(e){return e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear()},buscarCompetencia(){this.results=[],this.competencia.forEach(e=>this.buscarQuery(e))},buscarQuery(e){this.tablaFormateada=[],this.token=window.localStorage.getItem("token"),$.ajax({type:"GET",url:"https://api.mercadolibre.com/sites/MLA/search?nickname="+e,authorization:"Bearer "+this.token}).then(s=>{var i=s.paging.total,h=Math.ceil(i/50)-1;if(this.resultsOG=s.results,i>50)for(var r=1;r<=h;r++)this.offsetSearch(e,r);else i>0&&this.applyFilters()}).catch(s=>{s.response.error=="invalid_grant"&&u.checkParam(),s.response.message=="Invalid token"&&u.refreshToken(),console.log(s)})},offsetSearch(e,s){$.ajax({type:"GET",url:"https://api.mercadolibre.com/sites/MLA/search?nickname="+e+"&offset="+s*50,authorization:"Bearer "+this.token}).then(i=>{console.log(i.results),i.results.length>0&&(this.resultsOG.push(...i.results),this.applyFilters())}).catch(i=>{i.response.error=="invalid_grant"&&u.checkParam(),i.response.message=="Invalid token"&&u.refreshToken(),console.log(i)})},buscarUsuario(){if(this.username!=""){var e=window.localStorage.getItem("token");$.ajax({type:"GET",url:"https://api.mercadolibre.com/sites/MLA/search?nickname="+this.username+"&limit=0",authorization:"Bearer "+e}).then(s=>{s.seller!=null?(this.notfound=!1,this.username="",this.competencia.push(s.seller.nickname)):this.notfound=!0}).catch(s=>{errorsService.handleError(s)})}},applyFilters(){this.diasFiltro<1&&(this.diasFiltro=1),this.results=this.resultsOG},borrarUser(e){this.competencia.splice(e,1)},checkDias(){this.diasFiltro<1&&(this.diasFiltro=1)},formatTable(){this.results.forEach(e=>{var s={titulo:e.title,linkpubli:e.permalink,lastupdate:this.formatFecha(new Date(e.prices.prices[0].last_updated)),nombreeshop:e.seller.nickname,precio:e.price,disponibles:e.available_quantity,vendidos:e.sold_quantity,cuotas:e.installments!=null?e.installments.quantity:"-",intereses:e.installments.rate!=null?e.installments.rate:"-",envio:e.shipping.free_shipping};this.tablaFormateada.push(s)})},exportXlsx(){this.formatTable();var e="Comparacion-competencia",s=XLSX.utils.json_to_sheet(this.tablaFormateada);const i=XLSX.utils.book_new();XLSX.utils.book_append_sheet(i,s,"Publicaciones"),XLSX.utils.sheet_add_aoa(s,[["titulo","link de la publicacion","ultima modificacion","nombre del usuario","precio","cantidad disponible","cantidad vendidos","cuotas","interes","envio gratis"]],{origin:"A1"}),XLSX.writeFile(i,e+".xlsx",{compression:!0})}},computed:{filterDate(){var e=new Date;return e.setDate(this.fecha.getDate()-this.diasFiltro),e.setHours(0,0,0,0),e}}}),v={class:"container"},F=t("h2",null,"Medicion de Competencia",-1),w={class:"flex-inline"},S=t("label",{for:"dias"},"Rango de dias a buscar cambios",-1),D=t("label",{for:"dias"},"A\xF1adir nombre de usuario competidor",-1),X={key:0,style:{color:"red"}},C={class:"table-responsive",style:{"margin-top":"30px"}},L={id:"tabla",class:"table table-bordered"},q=["onClick"],E={key:0},T=t("td",null,[t("p",null,"No hay nombres de usuarios a\xF1adidos")],-1),B=[T],G={key:1,class:"table-responsive",style:{"margin-top":"20px"}},M={id:"tabla",class:"table table-bordered"},I=t("thead",null,[t("tr",null,[t("th",null,"img de portada"),t("th",null,"titulo"),t("th",null,"link de la publicacion"),t("th",null,"fecha de modificacion"),t("th",null,"nombre del usuario"),t("th",null,"precio"),t("th",null,"cantidad disponible"),t("th",null,"cantidad vendidos"),t("th",null,"cuotas"),t("th",null,"interes"),t("th",null,"envio gratis")])],-1),U=["src"],j=["href"],A=t("p",null,"Las cantidades de items vendidos y disponibles son aproximaciones",-1),N={key:2},O={key:3};function z(e,s,i,h,r,P){return n(),o("div",v,[F,t("div",w,[S,p(t("input",{type:"number",min:"1",max:"10",onChange:s[0]||(s[0]=a=>e.checkDias()),"onUpdate:modelValue":s[1]||(s[1]=a=>e.diasFiltro=a)},null,544),[[m,e.diasFiltro]]),D,p(t("input",{type:"text",class:"form-control",style:{width:"500px"},onKeyup:s[2]||(s[2]=_(a=>e.buscarUsuario(),["enter"])),"onUpdate:modelValue":s[3]||(s[3]=a=>e.username=a)},null,544),[[m,e.username]])]),e.notfound?(n(),o("p",X,"No se encontro el usuario")):d("",!0),t("div",C,[t("table",L,[t("tbody",null,[(n(!0),o(b,null,f(e.competencia,(a,c)=>(n(),o("tr",{key:c},[t("td",null,l(a),1),t("td",null,[t("button",{class:"btn btn-danger",onClick:V=>e.borrarUser(e.competencia.indexOf(a))},"borrar",8,q)])]))),128)),e.competencia.length==0?(n(),o("tr",E,B)):d("",!0)])])]),t("button",{class:"btn btn-primary",style:{"margin-top":"50px"},onClick:s[4]||(s[4]=a=>e.buscarCompetencia())},"Buscar"),e.results.length>0?(n(),o("div",G,[t("table",M,[I,t("tbody",null,[(n(!0),o(b,null,f(e.results,(a,c)=>(n(),o("tr",{key:c},[t("td",null,[t("img",{style:{"max-width":"100px","max-height":"100px"},src:a.thumbnail,alt:"logo"},null,8,U)]),t("td",null,l(a.title),1),t("td",null,[t("a",{href:a.permalink},l(a.permalink),9,j)]),t("td",null,l(a.seller.nickname),1),t("td",null,l(a.price),1),t("td",null,l(a.available_quantity),1),t("td",null,l(a.sold_quantity),1),t("td",null,l(a.installments!=null?a.installments.quantity:"-"),1),t("td",null,"%"+l(a.installments!=null?a.installments.rate:"-"),1),t("td",null,l(a.shipping.free_shipping),1)]))),128))])]),A])):d("",!0),e.results.length==0?(n(),o("p",N,"Realize una busqueda")):d("",!0),e.results.length==0?(n(),o("p",O,"No hay registro de cambios")):(n(),o("button",{key:4,onClick:s[5]||(s[5]=a=>e.exportXlsx())},"Exportar xlsx"))])}const K=k(y,[["render",z]]);export{K as default};
