import{_ as b,d as y,o as a,c as r,a as t,w as l,v as g,b as k,e as f,f as m,g as u,h,t as i,F as q,r as E,i as v}from"./index.21eb3156.js";const P=y({data(){return{queryBusqueda:"",queryBusquedaOG:"",code:"",results:[],resultsOG:[],precioAsc:!1,vendidosAsc:!1,eshopAsc:!1,tablaFormateada:[],filtroCuotas:"yes",filtraCuotas:!1,filtroEstado:"2230284",filtraEstado:!1,filtroEnvios:"free",filtraEnvios:!1,ordenPrecios:!0,itmPrice:"",keyword:""}},mounted(){var e=window.localStorage.getItem("token");e==null&&this.checkParam(),this.checkParam()},methods:{highlightMatches(e,s){const n=new RegExp(s,"gi");return e.replace(n,d=>`<span class="highlight">${d}</span>`)},checkParam(){console.log("checkparam"),this.$nextTick(()=>{console.log("checkparam 2");const e=new URLSearchParams(window.location.search);this.keyword=e.get("key"),this.itmPrice=e.get("price"),this.keyword&&(this.queryBusqueda=this.keyword,this.buscarQuery())})},queryFiltros(){var e="";return this.filtraCuotas&&(e="&installments="+this.filtroCuotas),this.filtraEstado&&(e+="&ITEM_CONDITION="+this.filtroEstado),this.filtraEnvios&&this.filtroEnvios!=""&&(e+="&shipping_cost="+this.filtroEnvios),e},ordenPorPrecios(){this.ordenPrecios?this.results=this.results.sort((e,s)=>s.price-e.price):this.results=this.results.sort((e,s)=>e.price-s.price),this.ordenPrecios=!this.ordenPrecios},buscarQuery(){var e=this.queryFiltros();this.tablaFormateada=[];var s=window.localStorage.getItem("token");this.queryBusquedaOG=this.queryBusqueda;var n=this.queryBusqueda.replaceAll(" ","%20"),d=0;this.results=[];var c=this;function p(){$.ajax({type:"GET",url:"https://api.mercadolibre.com/sites/MLA/search?q="+n+e+"&offset="+d,authorization:"Bearer "+s}).then(o=>{c.results.push(...o.results),o.results.length>0&&d<1e3&&(d+=50,p())}).catch(o=>{o.response.error=="invalid_grant"&&v.checkParam(),o.response.message=="Invalid token"&&v.refreshToken(),console.log(o)})}p()},formatTable(){this.results.forEach(e=>{var n,d,c,p;var s={titulo:e.title,linkpubli:e.permalink,linkvendedor:e.seller.permalink,nombreeshop:e.seller.eshop!=null?e.seller.eshop.nick_name:"-",condicion:e.condition,precio:e.price,disponibles:e.available_quantity,vendidos:e.sold_quantity,cuotas:(d=(n=e.installments)==null?void 0:n.quantity)!=null?d:"-",intereses:(p=(c=e.installments)==null?void 0:c.rate)!=null?p:"-",envio:e.shipping.free_shipping};e.installments==null&&console.log(e),this.tablaFormateada.push(s)})},exportXlsx(){this.formatTable();var e=this.queryBusquedaOG.replaceAll(" ","-"),s=XLSX.utils.json_to_sheet(this.tablaFormateada);const n=XLSX.utils.book_new();XLSX.utils.book_append_sheet(n,s,"Publicaciones"),XLSX.utils.sheet_add_aoa(s,[["titulo","link de la publicacion","link del vendedor","nombre del Eshop","condicion","precio","cantidad disponible","cantidad vendidos","cuotas","interes","envio gratis"]],{origin:"A1"}),XLSX.writeFile(n,e+".xlsx",{compression:!0})}}}),w={class:"container"},C=t("h2",null,"Metricas de de busqueda por producto",-1),B={class:"flex-inline"},V=["disabled"],T={class:"flex-inline-left",style:{"margin-top":"15px","margin-bottom":"5px"}},U={class:"flex-inline-left"},X={for:"festado"},L={key:0},S={class:"gap"},M=t("br",null,null,-1),F=t("label",{for:"nuevo"},"Nuevo",-1),A={class:"gap"},I=t("br",null,null,-1),N=t("label",{for:"usado"},"Usado",-1),O={class:"gap"},G=t("label",{for:"reacondicionado"},"Reacondicionado",-1),R={class:"flex-inline-left"},Q={for:"fcuotas"},j={key:0},D={class:"gap"},H=t("br",null,null,-1),K=t("label",{for:"interes"},"Todos",-1),z={class:"gap"},J=t("br",null,null,-1),W=t("label",{for:"nointeres"},"Sin interes",-1),Y={class:"flex-inline-left"},Z={for:"fenvios"},x={key:0},ee={class:"gap"},te=t("br",null,null,-1),oe=t("label",{for:"enviogratis"},"Envio gratis",-1),se={class:"gap"},ie=t("br",null,null,-1),le=t("label",{for:"enviopago"},"Todos",-1),ne={class:"flex-inline-between",style:{"margin-top":"15px","margin-bottom":"5px"}},ae={key:0},re={key:1},de={key:0,class:"table-responsive",style:{"margin-top":"20px"}},ue={id:"tabla",class:"table table-bordered"},he=t("th",null,"img de portada",-1),pe=t("th",null,"titulo",-1),ce={style:{cursor:"pointer"}},fe=t("th",null,"cantidad disponible",-1),me=t("th",null,"cantidad vendidos",-1),ve=t("th",null,"cuotas",-1),_e=t("th",null,"interes",-1),be=t("th",null,"envio gratis",-1),ye=t("th",null,"modo de envio",-1),ge=t("th",null,"link de la publicacion",-1),ke=t("th",null,"nombre del vendedor",-1),qe=t("th",null,"condicion",-1),Ee=["src"],Pe=["innerHTML"],we=["href"],Ce=t("p",null,"Las cantidades de items vendidos y disponibles son aproximaciones",-1);function Be(e,s,n,d,c,p){return a(),r("div",w,[C,t("div",B,[l(t("input",{type:"text",class:"form-control",onKeyup:s[0]||(s[0]=k(o=>e.buscarQuery(),["enter"])),"onUpdate:modelValue":s[1]||(s[1]=o=>e.queryBusqueda=o)},null,544),[[g,e.queryBusqueda]]),t("button",{disabled:e.queryBusqueda=="",class:"btn btn-primary",onClick:s[2]||(s[2]=o=>e.buscarQuery())},"Buscar",8,V)]),t("div",T,[t("div",U,[t("label",X,[f("Estado del Item "),l(t("input",{id:"festado",type:"checkbox","onUpdate:modelValue":s[3]||(s[3]=o=>e.filtraEstado=o)},null,512),[[m,e.filtraEstado]])]),e.filtraEstado?(a(),r("div",L,[t("div",S,[l(t("input",{"onUpdate:modelValue":s[4]||(s[4]=o=>e.filtroEstado=o),value:"2230284",type:"radio",id:"nuevo",name:"estado",checked:""},null,512),[[u,e.filtroEstado]]),M,F]),t("div",A,[l(t("input",{"onUpdate:modelValue":s[5]||(s[5]=o=>e.filtroEstado=o),value:"2230581",type:"radio",id:"usado",name:"estado"},null,512),[[u,e.filtroEstado]]),I,N]),t("div",O,[l(t("input",{"onUpdate:modelValue":s[6]||(s[6]=o=>e.filtroEstado=o),value:"2230582",type:"radio",id:"reacondicionado",name:"estado"},null,512),[[u,e.filtroEstado]]),G])])):h("",!0)]),t("div",R,[t("label",Q,[f("Cuotas "),l(t("input",{id:"fcuotas",type:"checkbox","onUpdate:modelValue":s[7]||(s[7]=o=>e.filtraCuotas=o)},null,512),[[m,e.filtraCuotas]])]),e.filtraCuotas?(a(),r("div",j,[t("div",D,[l(t("input",{"onUpdate:modelValue":s[8]||(s[8]=o=>e.filtroCuotas=o),value:"yes",type:"radio",id:"interes",name:"cuotas",checked:""},null,512),[[u,e.filtroCuotas]]),H,K]),t("div",z,[l(t("input",{"onUpdate:modelValue":s[9]||(s[9]=o=>e.filtroCuotas=o),value:"no_interest",type:"radio",id:"nointeres",name:"cuotas"},null,512),[[u,e.filtroCuotas]]),J,W])])):h("",!0)]),t("div",Y,[t("label",Z,[f("Envio "),l(t("input",{id:"fenvios",type:"checkbox","onUpdate:modelValue":s[10]||(s[10]=o=>e.filtraEnvios=o)},null,512),[[m,e.filtraEnvios]])]),e.filtraEnvios?(a(),r("div",x,[t("div",ee,[l(t("input",{"onUpdate:modelValue":s[11]||(s[11]=o=>e.filtroEnvios=o),value:"free",type:"radio",id:"enviogratis",name:"envio",checked:""},null,512),[[u,e.filtroEnvios]]),te,oe]),t("div",se,[l(t("input",{"onUpdate:modelValue":s[12]||(s[12]=o=>e.filtroEnvios=o),value:"",type:"radio",id:"enviopago",name:"envio"},null,512),[[u,e.filtroEnvios]]),ie,le])])):h("",!0)])]),t("div",ne,[e.results.length>0?(a(),r("p",ae,"Cantidad: "+i(e.results.length),1)):h("",!0),e.itmPrice?(a(),r("p",re,"Precio propio: $"+i(e.itmPrice),1)):h("",!0),e.results.length>0?(a(),r("button",{key:2,onClick:s[13]||(s[13]=o=>e.exportXlsx()),class:"btn btn-outline-success"},"Exportar")):h("",!0)]),e.results.length>0?(a(),r("div",de,[t("table",ue,[t("thead",null,[t("tr",null,[he,pe,t("th",ce,[t("p",{onClick:s[14]||(s[14]=o=>e.ordenPorPrecios())},"precio "+i(e.ordenPrecios?"\u2191":"\u2193"),1)]),fe,me,ve,_e,be,ye,ge,ke,qe])]),t("tbody",null,[(a(!0),r(q,null,E(e.results,(o,_)=>(a(),r("tr",{key:_},[t("td",null,[t("img",{style:{"max-width":"100px","max-height":"100px"},src:o.thumbnail,alt:"logo"},null,8,Ee)]),t("td",{innerHTML:e.highlightMatches(o.title,e.queryBusqueda)},null,8,Pe),t("td",null,i(o.price),1),t("td",null,i(o.available_quantity),1),t("td",null,i(o.sold_quantity),1),t("td",null,i(o.installments!=null?o.installments.quantity:"-"),1),t("td",null,"%"+i(o.installments!=null?o.installments.rate:"-"),1),t("td",null,i(o.shipping.free_shipping),1),t("td",null,i(o.shipping.mode),1),t("td",null,[t("a",{href:o.permalink},i(o.permalink),9,we)]),t("td",null,i(o.seller.nickname!=null?o.seller.nickname:"-"),1),t("td",null,i(o.condition),1)]))),128))])]),Ce])):h("",!0)])}const Te=b(P,[["render",Be]]);export{Te as default};
